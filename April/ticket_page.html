<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- (Your head content unchanged) -->
  </head>

  <body>
    <div class="page-wrapper d-flex flex-column min-vh-100">
      <!-- Navbar -->
      <div id="navbar"></div>

      <!-- Main Content -->
      <main class="container mt-3 pt-5 flex-grow-1">
        <section class="container my-5">
          <h2 class="text-center mb-4 ticket_h2">Get Your Tickets Below</h2>
          <div class="row justify-content-center" id="ticket-section"></div>
        </section>
      </main>

      <!-- Ticket Modal -->
      <div class="modal fade" id="ticketModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content shadow rounded-4 p-4">
            <div class="modal-header border-0">
              <h5 class="modal-title">Buy Ticket</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form id="paymentForm">
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input
                    type="text"
                    id="customerName"
                    class="form-control"
                    required
                    placeholder="Enter your full name"
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input
                    type="email"
                    id="customerEmail"
                    class="form-control"
                    required
                    placeholder="Enter your email"
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Quantity</label>
                  <input
                    type="number"
                    id="ticketQuantity"
                    min="1"
                    value="1"
                    class="form-control"
                    required
                  />
                </div>

                <div class="text-end">
                  <button type="submit" class="btn btn-primary rounded-pill">
                    Pay Now
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div id="footer"></div>
    </div>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>

    <!-- Flutterwave SDK -->
    <script src="https://checkout.flutterwave.com/v3.js"></script>

    <script>
      const ticketData = [
        {
          type: "early_bird",
          name: "Early Bird",
          price: 10000,
          desc: "Discounted access for early supporters.",
        },
        {
          type: "regular",
          name: "Regular Ticket",
          price: 15000,
          desc: "Access to all general areas of the event.",
        },
        {
          type: "stage_access",
          name: "Stage Access",
          price: 25000,
          desc: "Includes regular access + stage area + VIP Lounge.",
        },
      ];

      let selectedTicketType = null;
      let selectedTicketPrice = 0;

      function createTicketCards() {
        const container = document.getElementById("ticket-section");
        container.innerHTML = ticketData
          .map(
            (ticket) => `
          <div class="col-md-4 mb-4">
            <div class="card shadow rounded-4 p-4 h-100 d-flex flex-column justify-content-between">
              <div>
                <h3 class="text-center mb-3">${ticket.name}</h3>
                <p class="text-center">${ticket.desc}</p>
                <h4 class="text-center">â‚¦${ticket.price.toLocaleString()}</h4>
              </div>
              <div class="text-center mt-3">
                <button class="btn btn-primary rounded-pill px-4" onclick="openForm('${ticket.type}', ${ticket.price})">Buy Ticket</button>
              </div>
            </div>
          </div>
        `
          )
          .join("");
      }

      function openForm(type, price) {
        selectedTicketType = type;
        selectedTicketPrice = price;

        const modal = new bootstrap.Modal(document.getElementById("ticketModal"));
        document.getElementById("paymentForm").reset();
        document.getElementById("ticketQuantity").value = 1;

        modal.show();
      }

      function payWithFlutterwave() {
        const name = document.getElementById("customerName").value.trim();
        const email = document.getElementById("customerEmail").value.trim();
        const quantity = parseInt(document.getElementById("ticketQuantity").value.trim());

        if (!name || !email || quantity < 1) {
          alert("Please fill in all fields correctly.");
          return;
        }

        const amount = selectedTicketPrice * quantity;
        const tx_ref = `${selectedTicketType}_${Date.now()}`;

        // DEBUG: confirm user data before payment
        console.log("User Name:", name);
        console.log("User Email:", email);
        console.log("Ticket Quantity:", quantity);
        console.log("Total Amount:", amount);

        FlutterwaveCheckout({
          public_key: "FLWPUBK_TEST-e8837220d95dd27710f9ee75b7e24f42-X",
          tx_ref: tx_ref,
          amount: amount,
          currency: "NGN",
          payment_options: "card, banktransfer",
          customer: {
            name: name,
            email: email,
          },
          meta: {
            ticket_type: selectedTicketType,
            quantity: quantity,
            email: email,
            name: name,
          },
          redirect_url: `https://succes-page.vercel.app/?tx_ref=${encodeURIComponent(tx_ref)}&email=${encodeURIComponent(email)}&name=${encodeURIComponent(name)}`,
          customizations: {
            title: "Nature Entertainment",
            description: `Purchase of ${quantity} x ${selectedTicketType} ticket(s)`,
            logo: "./assets/Icon_color_512X512.png",
          },
          onclose: function () {
            // Optional: actions on modal close without payment
          },
          callback: function (data) {
            // Optional: handle callback (if needed)
            // Flutterwave auto-redirects to redirect_url after payment
          },
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        createTicketCards();

        document.getElementById("paymentForm").addEventListener("submit", function (e) {
          e.preventDefault();
          payWithFlutterwave();
        });

        // Load navbar and footer if applicable
        if (typeof LoadNavbarAndFooter === "function") {
          LoadNavbarAndFooter();
        }
      });
    </script>
  </body>
</html>
